<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOS Storytelling - API Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        /* Header */
        .header {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-logo h1 {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header-logo span {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .header-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .header-nav a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        .header-nav a:hover { color: #fff; }
        .header-nav a.active { color: #667eea; }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        .stat-card-icon.purple { background: linear-gradient(135deg, #667eea, #764ba2); }
        .stat-card-icon.green { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .stat-card-icon.orange { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .stat-card-icon.blue { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .stat-card-label {
            font-size: 0.85em;
            color: rgba(255,255,255,0.6);
            font-weight: 500;
        }
        .stat-card-value {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 8px;
        }
        .stat-card-change {
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .stat-card-change.up { color: #38ef7d; }
        .stat-card-change.down { color: #f5576c; }

        /* Section */
        .section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(238,90,36,0.4);
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 0.85em;
        }

        /* API Keys Table */
        .api-keys-table {
            width: 100%;
            border-collapse: collapse;
        }
        .api-keys-table th {
            text-align: left;
            padding: 16px;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .api-keys-table td {
            padding: 20px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            vertical-align: middle;
        }
        .api-keys-table tr:hover td {
            background: rgba(255,255,255,0.02);
        }
        .key-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .key-prefix {
            font-family: 'Monaco', 'Menlo', monospace;
            background: rgba(102,126,234,0.2);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #667eea;
        }
        .key-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .key-status.active {
            background: rgba(56,239,125,0.15);
            color: #38ef7d;
        }
        .key-status.inactive {
            background: rgba(245,87,108,0.15);
            color: #f5576c;
        }
        .key-actions {
            display: flex;
            gap: 8px;
        }
        .key-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .key-action-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        .key-action-btn.danger:hover {
            background: rgba(238,90,36,0.3);
            color: #ff6b6b;
        }

        /* Usage Progress */
        .usage-bar-container {
            width: 100%;
            max-width: 200px;
        }
        .usage-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        .usage-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .usage-bar-fill.warning { background: linear-gradient(90deg, #f5af19, #f12711); }
        .usage-bar-fill.danger { background: linear-gradient(90deg, #ff6b6b, #ee5a24); }
        .usage-text {
            font-size: 0.8em;
            color: rgba(255,255,255,0.6);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal {
            transform: scale(1);
        }
        .modal-header {
            padding: 24px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 1.3em;
            font-weight: 700;
        }
        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.2s;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.2);
        }
        .modal-body {
            padding: 30px;
        }
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
        }
        .form-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-family: inherit;
            font-size: 1em;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.2);
        }
        .form-input::placeholder {
            color: rgba(255,255,255,0.3);
        }
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 45px;
        }

        /* Key Display */
        .key-display {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .key-display-label {
            font-size: 0.85em;
            color: rgba(255,255,255,0.6);
            margin-bottom: 10px;
        }
        .key-display-value {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1.1em;
            color: #38ef7d;
            word-break: break-all;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .key-display-value button {
            flex-shrink: 0;
        }
        .key-warning {
            background: rgba(245,87,108,0.1);
            border: 1px solid rgba(245,87,108,0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        .key-warning-icon { font-size: 1.5em; }
        .key-warning-text {
            font-size: 0.9em;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
        }

        /* Code Examples */
        .code-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .code-tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.2s;
        }
        .code-tab:hover {
            background: rgba(255,255,255,0.1);
        }
        .code-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            position: relative;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            color: #c9d1d9;
        }
        .code-copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }
        .code-copy-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        .toast.error {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 40px;
        }
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .empty-state-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .empty-state-text {
            color: rgba(255,255,255,0.6);
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header { padding: 15px 20px; flex-direction: column; gap: 15px; }
            .main-container { padding: 20px; }
            .section { padding: 20px; }
            .api-keys-table { display: block; overflow-x: auto; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-logo">
            <h1>SOS Storytelling</h1>
            <span>API Enterprise</span>
        </div>
        <nav class="header-nav">
            <a href="#" class="active">Dashboard</a>
            <a href="API-DOCUMENTATION.md" target="_blank">Documentation</a>
            <a href="app.html">‚Üê Retour √† l'app</a>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-label">Requ√™tes ce mois</span>
                    <div class="stat-card-icon purple">üìä</div>
                </div>
                <div class="stat-card-value" id="statRequests">0</div>
                <div class="stat-card-change up" id="statRequestsChange">
                    <span>‚Üë 0%</span> vs mois dernier
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-label">Tokens utilis√©s</span>
                    <div class="stat-card-icon green">‚ö°</div>
                </div>
                <div class="stat-card-value" id="statTokens">0</div>
                <div class="stat-card-change up">
                    <span id="statTokensAvg">~0</span> par requ√™te
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-label">Cl√©s actives</span>
                    <div class="stat-card-icon orange">üîë</div>
                </div>
                <div class="stat-card-value" id="statKeys">0</div>
                <div class="stat-card-change">
                    <span id="statKeysLimit">/ 0</span> limite
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-label">Latence moyenne</span>
                    <div class="stat-card-icon blue">‚è±Ô∏è</div>
                </div>
                <div class="stat-card-value" id="statLatency">0<span style="font-size: 0.4em; font-weight: 500;">ms</span></div>
                <div class="stat-card-change up">
                    <span>Performance optimale</span>
                </div>
            </div>
        </div>

        <!-- API Keys Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üîê Mes cl√©s API</h2>
                <button class="btn btn-primary" onclick="openCreateKeyModal()">
                    ‚ûï Nouvelle cl√©
                </button>
            </div>

            <div id="apiKeysContent">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Code Examples Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üíª Exemples de code</h2>
            </div>

            <div class="code-tabs">
                <button class="code-tab active" onclick="showCodeExample('curl')">cURL</button>
                <button class="code-tab" onclick="showCodeExample('javascript')">JavaScript</button>
                <button class="code-tab" onclick="showCodeExample('python')">Python</button>
                <button class="code-tab" onclick="showCodeExample('php')">PHP</button>
            </div>

            <div class="code-block">
                <button class="code-copy-btn" onclick="copyCode()">üìã Copier</button>
                <pre id="codeExample"></pre>
            </div>
        </div>
    </div>

    <!-- Create Key Modal -->
    <div class="modal-overlay" id="createKeyModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üîë Cr√©er une cl√© API</h3>
                <button class="modal-close" onclick="closeModal('createKeyModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de la cl√©</label>
                    <input type="text" class="form-input" id="keyName" placeholder="Ex: Production, Test, etc.">
                </div>
                <div class="form-group">
                    <label class="form-label">Environnement</label>
                    <select class="form-input form-select" id="keyEnv">
                        <option value="live">üü¢ Live (Production)</option>
                        <option value="test">üü° Test (D√©veloppement)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Limite mensuelle</label>
                    <select class="form-input form-select" id="keyLimit">
                        <option value="1000">1 000 requ√™tes/mois</option>
                        <option value="5000">5 000 requ√™tes/mois</option>
                        <option value="10000">10 000 requ√™tes/mois</option>
                        <option value="50000">50 000 requ√™tes/mois</option>
                        <option value="100000">100 000 requ√™tes/mois (Enterprise)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createKeyModal')">Annuler</button>
                <button class="btn btn-primary" onclick="createKey()">Cr√©er la cl√©</button>
            </div>
        </div>
    </div>

    <!-- Key Created Modal -->
    <div class="modal-overlay" id="keyCreatedModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚úÖ Cl√© cr√©√©e avec succ√®s</h3>
                <button class="modal-close" onclick="closeModal('keyCreatedModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: rgba(255,255,255,0.8);">
                    Votre nouvelle cl√© API a √©t√© g√©n√©r√©e. Copiez-la maintenant, elle ne sera plus affich√©e.
                </p>

                <div class="key-display">
                    <div class="key-display-label">Votre cl√© API</div>
                    <div class="key-display-value">
                        <span id="newKeyValue">sk_live_xxxxxxxxxxxxxxxxxxxx</span>
                        <button class="btn btn-small btn-secondary" onclick="copyNewKey()">üìã Copier</button>
                    </div>
                </div>

                <div class="key-warning">
                    <span class="key-warning-icon">‚ö†Ô∏è</span>
                    <div class="key-warning-text">
                        <strong>Important :</strong> Cette cl√© ne sera affich√©e qu'une seule fois.
                        Sauvegardez-la dans un endroit s√©curis√©. Si vous la perdez, vous devrez en cr√©er une nouvelle.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('keyCreatedModal')">J'ai copi√© ma cl√©</button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal-overlay" id="deleteKeyModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üóëÔ∏è R√©voquer la cl√©</h3>
                <button class="modal-close" onclick="closeModal('deleteKeyModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: rgba(255,255,255,0.8);">
                    √ätes-vous s√ªr de vouloir r√©voquer cette cl√© API ?
                </p>
                <p style="color: #f5576c; margin-top: 12px;">
                    <strong>Attention :</strong> Cette action est irr√©versible. Toutes les requ√™tes utilisant cette cl√© seront rejet√©es.
                </p>
                <div class="key-display" style="margin-top: 20px;">
                    <div class="key-display-label">Cl√© √† r√©voquer</div>
                    <div style="color: #f5576c; font-family: monospace;" id="deleteKeyName">sk_live_xxxx...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteKeyModal')">Annuler</button>
                <button class="btn btn-danger" onclick="confirmDeleteKey()">R√©voquer d√©finitivement</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ============================================
        // Configuration
        // ============================================
        const API_BASE_URL = 'https://votre-worker.workers.dev'; // √Ä configurer
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';

        // ============================================
        // State
        // ============================================
        let apiKeys = [];
        let currentDeleteKeyId = null;
        let currentCodeLang = 'curl';

        // ============================================
        // Mock Data (pour d√©mo sans backend)
        // ============================================
        const mockKeys = [
            {
                id: '1',
                name: 'Production',
                key_prefix: 'sk_live_7x3K',
                is_active: true,
                rate_limit_monthly: 5000,
                requests_this_month: 1247,
                tokens_this_month: 156340,
                last_used_at: new Date(Date.now() - 3600000).toISOString(),
                created_at: new Date(Date.now() - 30*24*3600000).toISOString()
            },
            {
                id: '2',
                name: 'Test / Staging',
                key_prefix: 'sk_test_9Bm2',
                is_active: true,
                rate_limit_monthly: 1000,
                requests_this_month: 89,
                tokens_this_month: 12450,
                last_used_at: new Date(Date.now() - 86400000).toISOString(),
                created_at: new Date(Date.now() - 7*24*3600000).toISOString()
            }
        ];

        // ============================================
        // Code Examples
        // ============================================
        const codeExamples = {
            curl: `curl -X POST "${API_BASE_URL}/api/v1/generate" \\
  -H "Authorization: Bearer YOUR_API_KEY" \\
  -H "Content-Type: application/json" \\
  -d '{
    "prompt": "Comment j\\'ai transform√© mon √©chec en opportunit√©",
    "structure": "storytelling",
    "platform": "linkedin"
  }'`,
            javascript: `const response = await fetch('${API_BASE_URL}/api/v1/generate', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    prompt: "Comment j'ai transform√© mon √©chec en opportunit√©",
    structure: 'storytelling',
    platform: 'linkedin'
  })
});

const data = await response.json();
console.log(data.content);`,
            python: `import requests

response = requests.post(
    '${API_BASE_URL}/api/v1/generate',
    headers={
        'Authorization': 'Bearer YOUR_API_KEY',
        'Content-Type': 'application/json'
    },
    json={
        'prompt': "Comment j'ai transform√© mon √©chec en opportunit√©",
        'structure': 'storytelling',
        'platform': 'linkedin'
    }
)

data = response.json()
print(data['content'])`,
            php: `<?php
$ch = curl_init('${API_BASE_URL}/api/v1/generate');
curl_setopt_array($ch, [
    CURLOPT_POST => true,
    CURLOPT_HTTPHEADER => [
        'Authorization: Bearer YOUR_API_KEY',
        'Content-Type: application/json'
    ],
    CURLOPT_POSTFIELDS => json_encode([
        'prompt' => "Comment j'ai transform√© mon √©chec en opportunit√©",
        'structure' => 'storytelling',
        'platform' => 'linkedin'
    ]),
    CURLOPT_RETURNTRANSFER => true
]);

$response = curl_exec($ch);
$data = json_decode($response, true);
echo $data['content'];`
        };

        // ============================================
        // Initialization
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKeys();
            showCodeExample('curl');
        });

        // ============================================
        // API Keys Functions
        // ============================================
        async function loadApiKeys() {
            // Pour d√©mo, utiliser les mock data
            // En production, appeler l'API Supabase
            apiKeys = mockKeys;
            renderApiKeys();
            updateStats();
        }

        function renderApiKeys() {
            const container = document.getElementById('apiKeysContent');

            if (apiKeys.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîë</div>
                        <h3 class="empty-state-title">Aucune cl√© API</h3>
                        <p class="empty-state-text">Cr√©ez votre premi√®re cl√© pour commencer √† utiliser l'API.</p>
                        <button class="btn btn-primary" onclick="openCreateKeyModal()">
                            ‚ûï Cr√©er ma premi√®re cl√©
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <table class="api-keys-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Cl√©</th>
                            <th>Status</th>
                            <th>Usage ce mois</th>
                            <th>Derni√®re utilisation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${apiKeys.map(key => renderKeyRow(key)).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderKeyRow(key) {
            const usagePercent = (key.requests_this_month / key.rate_limit_monthly) * 100;
            const barClass = usagePercent > 90 ? 'danger' : (usagePercent > 70 ? 'warning' : '');
            const lastUsed = key.last_used_at
                ? formatRelativeTime(new Date(key.last_used_at))
                : 'Jamais';

            return `
                <tr>
                    <td>
                        <div class="key-name">${key.name}</div>
                        <div style="color: rgba(255,255,255,0.4); font-size: 0.8em;">
                            Cr√©√©e ${formatRelativeTime(new Date(key.created_at))}
                        </div>
                    </td>
                    <td>
                        <span class="key-prefix">${key.key_prefix}...</span>
                    </td>
                    <td>
                        <span class="key-status ${key.is_active ? 'active' : 'inactive'}">
                            ${key.is_active ? '‚óè Active' : '‚óã Inactive'}
                        </span>
                    </td>
                    <td>
                        <div class="usage-bar-container">
                            <div class="usage-bar">
                                <div class="usage-bar-fill ${barClass}" style="width: ${Math.min(usagePercent, 100)}%"></div>
                            </div>
                            <div class="usage-text">
                                ${key.requests_this_month.toLocaleString()} / ${key.rate_limit_monthly.toLocaleString()}
                            </div>
                        </div>
                    </td>
                    <td style="color: rgba(255,255,255,0.6);">${lastUsed}</td>
                    <td>
                        <div class="key-actions">
                            <button class="key-action-btn" onclick="copyKeyPrefix('${key.key_prefix}')" title="Copier le pr√©fixe">
                                üìã
                            </button>
                            <button class="key-action-btn" onclick="toggleKeyStatus('${key.id}')" title="${key.is_active ? 'D√©sactiver' : 'Activer'}">
                                ${key.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                            </button>
                            <button class="key-action-btn danger" onclick="deleteKey('${key.id}', '${key.key_prefix}')" title="R√©voquer">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function updateStats() {
            const totalRequests = apiKeys.reduce((sum, k) => sum + k.requests_this_month, 0);
            const totalTokens = apiKeys.reduce((sum, k) => sum + k.tokens_this_month, 0);
            const activeKeys = apiKeys.filter(k => k.is_active).length;
            const avgTokens = totalRequests > 0 ? Math.round(totalTokens / totalRequests) : 0;

            document.getElementById('statRequests').textContent = totalRequests.toLocaleString();
            document.getElementById('statTokens').textContent = totalTokens.toLocaleString();
            document.getElementById('statTokensAvg').textContent = `~${avgTokens}`;
            document.getElementById('statKeys').textContent = activeKeys;
            document.getElementById('statKeysLimit').textContent = `/ ${apiKeys.length}`;
            document.getElementById('statLatency').innerHTML = '2340<span style="font-size: 0.4em; font-weight: 500;">ms</span>';
        }

        // ============================================
        // Key Generation (local pour d√©mo)
        // ============================================
        function generateLocalKey(env) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let key = '';
            for (let i = 0; i < 32; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            const prefix = env === 'test' ? 'sk_test_' : 'sk_live_';
            return prefix + key;
        }

        function createKey() {
            const name = document.getElementById('keyName').value || 'Ma cl√© API';
            const env = document.getElementById('keyEnv').value;
            const limit = parseInt(document.getElementById('keyLimit').value);

            // G√©n√©rer la cl√© localement (en prod, appeler l'API)
            const fullKey = generateLocalKey(env);
            const keyPrefix = fullKey.substring(0, 12);

            // Ajouter √† la liste (en prod, sauvegarder dans Supabase)
            const newKey = {
                id: Date.now().toString(),
                name: name,
                key_prefix: keyPrefix,
                is_active: true,
                rate_limit_monthly: limit,
                requests_this_month: 0,
                tokens_this_month: 0,
                last_used_at: null,
                created_at: new Date().toISOString()
            };

            apiKeys.unshift(newKey);
            renderApiKeys();
            updateStats();

            // Afficher la cl√© compl√®te
            document.getElementById('newKeyValue').textContent = fullKey;
            closeModal('createKeyModal');
            openModal('keyCreatedModal');

            // Reset form
            document.getElementById('keyName').value = '';
        }

        function copyNewKey() {
            const key = document.getElementById('newKeyValue').textContent;
            navigator.clipboard.writeText(key).then(() => {
                showToast('‚úÖ Cl√© copi√©e !');
            });
        }

        function copyKeyPrefix(prefix) {
            navigator.clipboard.writeText(prefix).then(() => {
                showToast('‚úÖ Pr√©fixe copi√© !');
            });
        }

        function toggleKeyStatus(keyId) {
            const key = apiKeys.find(k => k.id === keyId);
            if (key) {
                key.is_active = !key.is_active;
                renderApiKeys();
                showToast(key.is_active ? '‚úÖ Cl√© activ√©e' : '‚è∏Ô∏è Cl√© d√©sactiv√©e');
            }
        }

        function deleteKey(keyId, keyPrefix) {
            currentDeleteKeyId = keyId;
            document.getElementById('deleteKeyName').textContent = keyPrefix + '...';
            openModal('deleteKeyModal');
        }

        function confirmDeleteKey() {
            apiKeys = apiKeys.filter(k => k.id !== currentDeleteKeyId);
            renderApiKeys();
            updateStats();
            closeModal('deleteKeyModal');
            showToast('üóëÔ∏è Cl√© r√©voqu√©e');
            currentDeleteKeyId = null;
        }

        // ============================================
        // Code Examples
        // ============================================
        function showCodeExample(lang) {
            currentCodeLang = lang;

            // Update tabs
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.classList.toggle('active', tab.textContent.toLowerCase().includes(lang));
            });

            // Update code
            document.getElementById('codeExample').textContent = codeExamples[lang];
        }

        function copyCode() {
            navigator.clipboard.writeText(codeExamples[currentCodeLang]).then(() => {
                showToast('‚úÖ Code copi√© !');
            });
        }

        // ============================================
        // Modals
        // ============================================
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function openCreateKeyModal() {
            openModal('createKeyModal');
        }

        // ============================================
        // Utilities
        // ============================================
        function formatRelativeTime(date) {
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 30) return `il y a ${Math.floor(days/30)} mois`;
            if (days > 0) return `il y a ${days}j`;
            if (hours > 0) return `il y a ${hours}h`;
            if (minutes > 0) return `il y a ${minutes}min`;
            return '√Ä l\'instant';
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.toggle('error', isError);
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modal on outside click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // Close modal on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>
